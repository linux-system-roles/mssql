---
- name: Purge cluster and mssql configuration
  hosts: all
  tasks:
    - name: Purge cluster configuration
      vars:
        ha_cluster_cluster_present: no
        ha_cluster_enable_repos: false
      include_role:
        name: fedora.linux_system_roles.ha_cluster

    - name: Remove cluster RPMs
      package:
        name:
          - pacemaker
          - pcs
          - fence-agents-all
          - resource-agents
        state: absent

    - name: Remove mssql RPMs
      shell: dnf remove mssql-* -y
      changed_when: true

    - name: Remove related files
      shell: rm -rf /var/opt/mssql/ /opt/mssql* /tmp/ansible.*
      changed_when: true
