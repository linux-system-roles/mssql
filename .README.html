<!DOCTYPE html>
<!--
==============================================================================
           "GitHub HTML5 Pandoc Template" v2.2 — by Tristano Ajmone
==============================================================================
Copyright © Tristano Ajmone, 2017-2020, MIT License (MIT). Project's home:

- https://github.com/tajmone/pandoc-goodies

The CSS in this template reuses source code taken from the following projects:

- GitHub Markdown CSS: Copyright © Sindre Sorhus, MIT License (MIT):
  https://github.com/sindresorhus/github-markdown-css

- Primer CSS: Copyright © 2016-2017 GitHub Inc., MIT License (MIT):
  http://primercss.io/

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The MIT License

Copyright (c) Tristano Ajmone, 2017-2020 (github.com/tajmone/pandoc-goodies)
Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (sindresorhus.com)
Copyright (c) 2017 GitHub Inc.

"GitHub Pandoc HTML5 Template" is Copyright (c) Tristano Ajmone, 2017-2020,
released under the MIT License (MIT); it contains readaptations of substantial
portions of the following third party softwares:

(1) "GitHub Markdown CSS", Copyright (c) Sindre Sorhus, MIT License (MIT).
(2) "Primer CSS", Copyright (c) 2016 GitHub Inc., MIT License (MIT).

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
==============================================================================-->
<html>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Microsoft SQL Server</title>
  <style type="text/css">
@charset "UTF-8";.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:16px;line-height:1.5;word-wrap:break-word;box-sizing:border-box;min-width:200px;margin:0 auto;padding:45px}.markdown-body a{color:#0366d6;background-color:transparent;text-decoration:none;-webkit-text-decoration-skip:objects}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body a:hover{text-decoration:underline}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body strong{font-weight:600}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em;margin:.67em 0;padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{padding-bottom:.3em;font-size:1.5em;border-bottom:1px solid #eaecef}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body img{border-style:none}.markdown-body svg:not(:root){overflow:hidden}.markdown-body hr{box-sizing:content-box;height:.25em;margin:24px 0;padding:0;overflow:hidden;background-color:#e1e4e8;border:0}.markdown-body hr::before{display:table;content:""}.markdown-body hr::after{display:table;clear:both;content:""}.markdown-body input{margin:0;overflow:visible;font:inherit;font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dd{margin-left:0}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body code{font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace}.markdown-body pre{font:12px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;word-wrap:normal}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body table{display:block;width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code::after,.markdown-body code::before{letter-spacing:-.2em;content:" "}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code::after,.markdown-body pre code::before{content:normal}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body kbd{box-shadow:inset 0 -1px 0 #959da5;display:inline-block;padding:3px 5px;font:11px/10px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;color:#444d56;vertical-align:middle;background-color:#fcfcfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body::before{display:table;content:""}.markdown-body::after{display:table;clear:both;content:""}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.Alert,.Error,.Note,.Success,.Warning{padding:11px;margin-bottom:24px;border-style:solid;border-width:1px;border-radius:4px}.Alert p,.Error p,.Note p,.Success p,.Warning p{margin-top:0}.Alert p:last-child,.Error p:last-child,.Note p:last-child,.Success p:last-child,.Warning p:last-child{margin-bottom:0}.Alert{color:#246;background-color:#e2eef9;border-color:#bac6d3}.Warning{color:#4c4a42;background-color:#fff9ea;border-color:#dfd8c2}.Error{color:#911;background-color:#fcdede;border-color:#d2b2b2}.Success{color:#22662c;background-color:#e2f9e5;border-color:#bad3be}.Note{color:#2f363d;background-color:#f6f8fa;border-color:#d5d8da}.Alert h1,.Alert h2,.Alert h3,.Alert h4,.Alert h5,.Alert h6{color:#246;margin-bottom:0}.Warning h1,.Warning h2,.Warning h3,.Warning h4,.Warning h5,.Warning h6{color:#4c4a42;margin-bottom:0}.Error h1,.Error h2,.Error h3,.Error h4,.Error h5,.Error h6{color:#911;margin-bottom:0}.Success h1,.Success h2,.Success h3,.Success h4,.Success h5,.Success h6{color:#22662c;margin-bottom:0}.Note h1,.Note h2,.Note h3,.Note h4,.Note h5,.Note h6{color:#2f363d;margin-bottom:0}.Alert h1:first-child,.Alert h2:first-child,.Alert h3:first-child,.Alert h4:first-child,.Alert h5:first-child,.Alert h6:first-child,.Error h1:first-child,.Error h2:first-child,.Error h3:first-child,.Error h4:first-child,.Error h5:first-child,.Error h6:first-child,.Note h1:first-child,.Note h2:first-child,.Note h3:first-child,.Note h4:first-child,.Note h5:first-child,.Note h6:first-child,.Success h1:first-child,.Success h2:first-child,.Success h3:first-child,.Success h4:first-child,.Success h5:first-child,.Success h6:first-child,.Warning h1:first-child,.Warning h2:first-child,.Warning h3:first-child,.Warning h4:first-child,.Warning h5:first-child,.Warning h6:first-child{margin-top:0}h1.title,p.subtitle{text-align:center}h1.title.followed-by-subtitle{margin-bottom:0}p.subtitle{font-size:1.5em;font-weight:600;line-height:1.25;margin-top:0;margin-bottom:16px;padding-bottom:.3em}div.line-block{white-space:pre-line}
  </style>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<article class="markdown-body">
<header>
<h1 class="title">Microsoft SQL Server</h1>
</header>
<hr>
<nav id="TOC">
<h1 class="toc-title">Contents</h1>
<ul>
<li><a href="#requirements" id="toc-requirements">Requirements</a></li>
<li><a href="#configuring-general-sql-server-settings"
id="toc-configuring-general-sql-server-settings">Configuring General SQL
Server Settings</a>
<ul>
<li><a href="#general-settings-variables"
id="toc-general-settings-variables">General Settings Variables</a>
<ul>
<li><a href="#mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula"
id="toc-mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</a></li>
<li><a href="#mssql_accept_microsoft_cli_utilities_for_sql_server_eula"
id="toc-mssql_accept_microsoft_cli_utilities_for_sql_server_eula">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</a></li>
<li><a href="#mssql_accept_microsoft_sql_server_standard_eula"
id="toc-mssql_accept_microsoft_sql_server_standard_eula">mssql_accept_microsoft_sql_server_standard_eula</a></li>
<li><a href="#mssql_password"
id="toc-mssql_password">mssql_password</a></li>
<li><a href="#mssql_edition"
id="toc-mssql_edition">mssql_edition</a></li>
<li><a href="#mssql_enable_sql_agent"
id="toc-mssql_enable_sql_agent">mssql_enable_sql_agent</a></li>
<li><a href="#mssql_tune_for_fua_storage"
id="toc-mssql_tune_for_fua_storage">mssql_tune_for_fua_storage</a></li>
</ul></li>
<li><a href="#general-settings-example-playbooks"
id="toc-general-settings-example-playbooks">General Settings Example
Playbooks</a>
<ul>
<li><a href="#configuring-basic-sql-server"
id="toc-configuring-basic-sql-server">Configuring Basic SQL
Server</a></li>
</ul></li>
</ul></li>
<li><a href="#managing-sql-server-version"
id="toc-managing-sql-server-version">Managing SQL Server version</a>
<ul>
<li><a href="#managing-version-considerations"
id="toc-managing-version-considerations">Managing Version
Considerations</a></li>
<li><a href="#managing-version-variables"
id="toc-managing-version-variables">Managing Version Variables</a>
<ul>
<li><a href="#mssql_version"
id="toc-mssql_version">mssql_version</a></li>
<li><a href="#mssql_upgrade"
id="toc-mssql_upgrade">mssql_upgrade</a></li>
</ul></li>
</ul></li>
<li><a href="#configuring-sql-server-as-a-confined-application-el-9"
id="toc-configuring-sql-server-as-a-confined-application-el-9">Configuring
SQL Server as a Confined Application (EL 9)</a>
<ul>
<li><a
href="#configuring-sql-server-as-a-confined-application-variables"
id="toc-configuring-sql-server-as-a-confined-application-variables">Configuring
SQL Server as a Confined Application Variables</a>
<ul>
<li><a href="#mssql_run_selinux_confined"
id="toc-mssql_run_selinux_confined">mssql_run_selinux_confined</a></li>
<li><a href="#mssql_manage_selinux"
id="toc-mssql_manage_selinux">mssql_manage_selinux</a></li>
</ul></li>
<li><a
href="#configuring-sql-server-as-a-confined-application-example-playbook"
id="toc-configuring-sql-server-as-a-confined-application-example-playbook">Configuring
SQL Server as a Confined Application Example Playbook</a></li>
</ul></li>
<li><a href="#inputting-sql-scripts-to-sql-server"
id="toc-inputting-sql-scripts-to-sql-server">Inputting SQL Scripts to
SQL Server</a>
<ul>
<li><a href="#inputting-sql-scripts-variables"
id="toc-inputting-sql-scripts-variables">Inputting SQL Scripts
Variables</a>
<ul>
<li><a href="#mssql_input_sql_file"
id="toc-mssql_input_sql_file">mssql_input_sql_file</a></li>
<li><a href="#mssql_pre_input_sql_file-and-mssql_post_input_sql_file"
id="toc-mssql_pre_input_sql_file-and-mssql_post_input_sql_file">mssql_pre_input_sql_file
and mssql_post_input_sql_file</a></li>
<li><a
href="#mssql_pre_input_sql_content-and-mssql_post_input_sql_content"
id="toc-mssql_pre_input_sql_content-and-mssql_post_input_sql_content">mssql_pre_input_sql_content
and mssql_post_input_sql_content</a></li>
<li><a href="#mssql_debug" id="toc-mssql_debug">mssql_debug</a></li>
</ul></li>
<li><a href="#inputting-sql-scripts-example-playbooks"
id="toc-inputting-sql-scripts-example-playbooks">Inputting SQL Scripts
Example Playbooks</a>
<ul>
<li><a href="#inputting-sql-script-files-and-content-to-sql-server"
id="toc-inputting-sql-script-files-and-content-to-sql-server">Inputting
SQL script files and content to SQL Server</a></li>
</ul></li>
</ul></li>
<li><a href="#installing-additional-packages"
id="toc-installing-additional-packages">Installing Additional
Packages</a>
<ul>
<li><a href="#additional-packages-variables"
id="toc-additional-packages-variables">Additional Packages Variables</a>
<ul>
<li><a href="#mssql_install_fts"
id="toc-mssql_install_fts">mssql_install_fts</a></li>
<li><a href="#mssql_install_powershell"
id="toc-mssql_install_powershell">mssql_install_powershell</a></li>
</ul></li>
</ul></li>
<li><a href="#configuring-custom-urls-for-packages"
id="toc-configuring-custom-urls-for-packages">Configuring Custom URLs
for Packages</a>
<ul>
<li><a href="#custom-urls-variables"
id="toc-custom-urls-variables">Custom URLs Variables</a>
<ul>
<li><a href="#mssql_rpm_key"
id="toc-mssql_rpm_key">mssql_rpm_key</a></li>
<li><a href="#mssql_server_repository"
id="toc-mssql_server_repository">mssql_server_repository</a></li>
<li><a href="#mssql_client_repository"
id="toc-mssql_client_repository">mssql_client_repository</a></li>
</ul></li>
</ul></li>
<li><a href="#configuring-custom-data-and-logs-storage-paths"
id="toc-configuring-custom-data-and-logs-storage-paths">Configuring
Custom Data and Logs Storage Paths</a>
<ul>
<li><a href="#custom-paths-variables"
id="toc-custom-paths-variables">Custom Paths Variables</a>
<ul>
<li><a href="#mssql_datadir"
id="toc-mssql_datadir">mssql_datadir</a></li>
<li><a href="#mssql_datadir_mode"
id="toc-mssql_datadir_mode">mssql_datadir_mode</a></li>
<li><a href="#mssql_logdir" id="toc-mssql_logdir">mssql_logdir</a></li>
<li><a href="#mssql_logdir_mode"
id="toc-mssql_logdir_mode">mssql_logdir_mode</a></li>
</ul></li>
</ul></li>
<li><a href="#configuring-network-parameters"
id="toc-configuring-network-parameters">Configuring Network
Parameters</a>
<ul>
<li><a href="#network-parameters-variables"
id="toc-network-parameters-variables">Network Parameters Variables</a>
<ul>
<li><a href="#mssql_ip_address"
id="toc-mssql_ip_address">mssql_ip_address</a></li>
<li><a href="#mssql_tcp_port"
id="toc-mssql_tcp_port">mssql_tcp_port</a></li>
<li><a href="#mssql_manage_firewall"
id="toc-mssql_manage_firewall">mssql_manage_firewall</a></li>
</ul></li>
<li><a href="#network-parameters-example-playbooks"
id="toc-network-parameters-example-playbooks">Network Parameters Example
Playbooks</a>
<ul>
<li><a href="#configuring-sql-server-with-custom-network-parameters"
id="toc-configuring-sql-server-with-custom-network-parameters">Configuring
SQL Server with Custom Network Parameters</a></li>
</ul></li>
</ul></li>
<li><a href="#configuring-tls-certificates"
id="toc-configuring-tls-certificates">Configuring TLS Certificates</a>
<ul>
<li><a href="#tls-certificates-variables"
id="toc-tls-certificates-variables">TLS Certificates Variables</a>
<ul>
<li><a href="#mssql_tls_enable"
id="toc-mssql_tls_enable">mssql_tls_enable</a></li>
<li><a href="#mssql_tls_certificates"
id="toc-mssql_tls_certificates">mssql_tls_certificates</a></li>
<li><a href="#mssql_tls_cert-and-mssql_tls_private_key"
id="toc-mssql_tls_cert-and-mssql_tls_private_key">mssql_tls_cert and
mssql_tls_private_key</a></li>
<li><a href="#mssql_tls_remote_src"
id="toc-mssql_tls_remote_src">mssql_tls_remote_src</a></li>
<li><a href="#mssql_tls_version"
id="toc-mssql_tls_version">mssql_tls_version</a></li>
<li><a href="#mssql_tls_force"
id="toc-mssql_tls_force">mssql_tls_force</a></li>
</ul></li>
<li><a href="#tls-certificates-example-playbooks"
id="toc-tls-certificates-example-playbooks">TLS Certificates Example
Playbooks</a>
<ul>
<li><a
href="#configuring-sql-server-with-tls-encryption-with-certificate-files"
id="toc-configuring-sql-server-with-tls-encryption-with-certificate-files">Configuring
SQL Server with TLS Encryption with Certificate Files</a></li>
<li><a
href="#configuring-sql-server-with-tls-encryption-with-the-certificate-role"
id="toc-configuring-sql-server-with-tls-encryption-with-the-certificate-role">Configuring
SQL Server with TLS Encryption with the Certificate Role</a></li>
</ul></li>
</ul></li>
<li><a href="#configuring-always-on-availability-group"
id="toc-configuring-always-on-availability-group">Configuring Always On
Availability Group</a>
<ul>
<li><a href="#always-on-availability-group-prerequisites"
id="toc-always-on-availability-group-prerequisites">Always On
Availability Group Prerequisites</a></li>
<li><a href="#configuring-the-ansible-inventory"
id="toc-configuring-the-ansible-inventory">Configuring the Ansible
Inventory</a></li>
<li><a href="#always-on-availability-group-variables"
id="toc-always-on-availability-group-variables">Always On Availability
Group Variables</a>
<ul>
<li><a href="#mssql_ha_configure"
id="toc-mssql_ha_configure">mssql_ha_configure</a></li>
<li><a href="#mssql_ha_ag_cluster_type"
id="toc-mssql_ha_ag_cluster_type">mssql_ha_ag_cluster_type</a></li>
<li><a href="#mssql_ha_replica_type"
id="toc-mssql_ha_replica_type">mssql_ha_replica_type</a></li>
<li><a href="#mssql_ha_endpoint_port"
id="toc-mssql_ha_endpoint_port">mssql_ha_endpoint_port</a></li>
<li><a href="#mssql_ha_cert_name"
id="toc-mssql_ha_cert_name">mssql_ha_cert_name</a></li>
<li><a href="#mssql_ha_master_key_password"
id="toc-mssql_ha_master_key_password">mssql_ha_master_key_password</a></li>
<li><a href="#mssql_ha_private_key_password"
id="toc-mssql_ha_private_key_password">mssql_ha_private_key_password</a></li>
<li><a href="#mssql_ha_reset_cert"
id="toc-mssql_ha_reset_cert">mssql_ha_reset_cert</a></li>
<li><a href="#mssql_ha_endpoint_name"
id="toc-mssql_ha_endpoint_name">mssql_ha_endpoint_name</a></li>
<li><a href="#mssql_ha_ag_name"
id="toc-mssql_ha_ag_name">mssql_ha_ag_name</a></li>
<li><a href="#mssql_ha_db_names"
id="toc-mssql_ha_db_names">mssql_ha_db_names</a></li>
</ul></li>
<li><a href="#configuring-pacemaker-variables"
id="toc-configuring-pacemaker-variables">Configuring Pacemaker
Variables</a>
<ul>
<li><a href="#mssql_ha_prep_for_pacemaker"
id="toc-mssql_ha_prep_for_pacemaker">mssql_ha_prep_for_pacemaker</a></li>
<li><a href="#mssql_ha_virtual_ip"
id="toc-mssql_ha_virtual_ip">mssql_ha_virtual_ip</a></li>
<li><a href="#mssql_ha_login"
id="toc-mssql_ha_login">mssql_ha_login</a></li>
<li><a href="#mssql_ha_login_password"
id="toc-mssql_ha_login_password">mssql_ha_login_password</a></li>
<li><a href="#mssql_manage_ha_cluster"
id="toc-mssql_manage_ha_cluster">mssql_manage_ha_cluster</a></li>
</ul></li>
<li><a href="#always-on-availability-group-example-playbooks"
id="toc-always-on-availability-group-example-playbooks">Always On
Availability Group Example Playbooks</a>
<ul>
<li><a href="#example-inventory-for-ha-configuration"
id="toc-example-inventory-for-ha-configuration">Example Inventory for HA
Configuration</a></li>
<li><a
href="#configuring-sql-server-with-a-none-cluster-type-for-read-scale-without-pacemaker"
id="toc-configuring-sql-server-with-a-none-cluster-type-for-read-scale-without-pacemaker">Configuring
SQL Server with a <code>none</code> Cluster Type for Read-scale without
Pacemaker</a></li>
<li><a
href="#configuring-sql-server-with-ha-and-pacemaker-on-bare-metal"
id="toc-configuring-sql-server-with-ha-and-pacemaker-on-bare-metal">Configuring
SQL Server with HA and Pacemaker on Bare Metal</a></li>
<li><a href="#configuring-sql-server-with-ha-and-pacemaker-on-vmware"
id="toc-configuring-sql-server-with-ha-and-pacemaker-on-vmware">Configuring
SQL Server with HA and Pacemaker on VMWare</a></li>
<li><a href="#configuring-sql-server-with-ha-and-pacemaker-on-azure"
id="toc-configuring-sql-server-with-ha-and-pacemaker-on-azure">Configuring
SQL Server with HA and Pacemaker on Azure</a></li>
<li><a href="#ha-and-pacemaker-on-azure-prerequisites"
id="toc-ha-and-pacemaker-on-azure-prerequisites">HA and Pacemaker on
Azure Prerequisites</a></li>
</ul></li>
</ul></li>
<li><a
href="#configuring-sql-server-to-authenticate-with-active-directory-ad-server"
id="toc-configuring-sql-server-to-authenticate-with-active-directory-ad-server">Configuring
SQL Server to authenticate with Active Directory (AD) Server</a>
<ul>
<li><a href="#ad-considerations" id="toc-ad-considerations">AD
Considerations</a></li>
<li><a href="#ad-prerequisites" id="toc-ad-prerequisites">AD
Prerequisites</a></li>
<li><a href="#finishing-ad-server-configuration"
id="toc-finishing-ad-server-configuration">Finishing AD Server
Configuration</a></li>
<li><a href="#verifying-authentication"
id="toc-verifying-authentication">Verifying Authentication</a></li>
<li><a href="#ad-variables" id="toc-ad-variables">AD Variables</a>
<ul>
<li><a href="#mssql_ad_configure"
id="toc-mssql_ad_configure">mssql_ad_configure</a></li>
<li><a href="#mssql_ad_join"
id="toc-mssql_ad_join">mssql_ad_join</a></li>
<li><a href="#mssql_ad_kerberos_user"
id="toc-mssql_ad_kerberos_user">mssql_ad_kerberos_user</a></li>
<li><a href="#mssql_ad_kerberos_password"
id="toc-mssql_ad_kerberos_password">mssql_ad_kerberos_password</a></li>
<li><a href="#mssql_ad_keytab_file"
id="toc-mssql_ad_keytab_file">mssql_ad_keytab_file</a></li>
<li><a href="#mssql_ad_keytab_remote_src"
id="toc-mssql_ad_keytab_remote_src">mssql_ad_keytab_remote_src</a></li>
<li><a href="#mssql_ad_sql_user"
id="toc-mssql_ad_sql_user">mssql_ad_sql_user</a></li>
<li><a href="#mssql_ad_sql_password"
id="toc-mssql_ad_sql_password">mssql_ad_sql_password</a></li>
<li><a href="#mssql_ad_sql_user_dn"
id="toc-mssql_ad_sql_user_dn">mssql_ad_sql_user_dn</a></li>
</ul></li>
<li><a href="#ad-example-playbooks" id="toc-ad-example-playbooks">AD
Example Playbooks</a>
<ul>
<li><a href="#configuring-ad-integration-with-general-parameters"
id="toc-configuring-ad-integration-with-general-parameters">Configuring
AD integration with general parameters</a></li>
<li><a href="#configuring-ad-integration-with-a-pre-created-keytab-file"
id="toc-configuring-ad-integration-with-a-pre-created-keytab-file">Configuring
AD integration with a pre-created keytab file</a></li>
<li><a href="#configuring-ad-integration-without-joining-to-ad"
id="toc-configuring-ad-integration-without-joining-to-ad">Configuring AD
integration without joining to AD</a></li>
</ul></li>
</ul></li>
<li><a href="#license" id="toc-license">License</a></li>
</ul>
</nav>
<hr>
<p>This role installs, configures, and starts Microsoft SQL Server.</p>
<p>The role also optimizes the operating system to improve performance
and throughput for SQL Server by applying the <code>mssql</code> Tuned
profile.</p>
<h1 id="requirements">Requirements</h1>
<ul>
<li>SQL Server requires a machine with at least 2000 megabytes of
memory.</li>
<li>Optional: If you want to input T-SQL statements and stored
procedures to SQL Server, you must create a file with the
<code>.sql</code> extension containing these SQL statements and
procedures.</li>
</ul>
<h1 id="configuring-general-sql-server-settings">Configuring General SQL
Server Settings</h1>
<p>These variables apply to general SQL Server configuration.</p>
<h2 id="general-settings-variables">General Settings Variables</h2>
<h3
id="mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</h3>
<p>Set this variable to <code>true</code> to indicate that you accept
EULA for installing the <code>msodbcsql17</code> package.</p>
<p>The license terms for this product can be downloaded from <a
href="https://aka.ms/odbc17eula">https://aka.ms/odbc17eula</a> and found
in <code>/usr/share/doc/msodbcsql17/LICENSE.txt</code>.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3
id="mssql_accept_microsoft_cli_utilities_for_sql_server_eula">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</h3>
<p>Set this variable to <code>true</code> to indicate that you accept
EULA for installing the <code>mssql-tools</code> package.</p>
<p>The license terms for this product can be downloaded from <a
href="http://go.microsoft.com/fwlink/?LinkId=746949">http://go.microsoft.com/fwlink/?LinkId=746949</a>
and found in <code>/usr/share/doc/mssql-tools/LICENSE.txt</code>.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3
id="mssql_accept_microsoft_sql_server_standard_eula">mssql_accept_microsoft_sql_server_standard_eula</h3>
<p>Set this variable to <code>true</code> to indicate that you accept
EULA for using Microsoft SQL Server.</p>
<p>The license terms for this product can be found in
<code>/usr/share/doc/mssql-server</code> or downloaded from <a
href="https://go.microsoft.com/fwlink/?LinkId=2104078&amp;clcid=0x409">https://go.microsoft.com/fwlink/?LinkId=2104078&amp;clcid=0x409</a>.
The privacy statement can be viewed at <a
href="https://go.microsoft.com/fwlink/?LinkId=853010&amp;clcid=0x409">https://go.microsoft.com/fwlink/?LinkId=853010&amp;clcid=0x409</a>.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_password">mssql_password</h3>
<p>The password for the database sa user. The password must have a
minimum length of 8 characters, include uppercase and lowercase letters,
base 10 digits or non-alphanumeric symbols. Do not use single quotes
('), double quotes ("), and spaces in the password because
<code>sqlcmd</code> cannot authorize when the password includes those
symbols.</p>
<p>This variable is required when you run the role to install SQL
Server.</p>
<p>When running this role on a host that has SQL Server installed, the
<code>mssql_password</code> variable overwrites the existing sa user
password to the one that you specified.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_edition">mssql_edition</h3>
<p>The edition of SQL Server to install.</p>
<p>This variable is required when you run the role to install SQL
Server.</p>
<p>Use one of the following values:</p>
<ul>
<li><code>Enterprise</code></li>
<li><code>Standard</code></li>
<li><code>Web</code></li>
<li><code>Developer</code></li>
<li><code>Express</code></li>
<li><code>Evaluation</code></li>
<li>A product key in the form
<code>#####-#####-#####-#####-#####</code>, where <code>#</code> is a
number or a letter. For more information, see <a
href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-environment-variables?view=sql-server-ver16">Configure
SQL Server settings with environment variables on Linux</a>.</li>
</ul>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_enable_sql_agent">mssql_enable_sql_agent</h3>
<p>Optional: Set this variable to <code>true</code> or
<code>false</code> to enable or disable the SQL agent.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_tune_for_fua_storage">mssql_tune_for_fua_storage</h3>
<p>Optional: Set this variable to <code>true</code> or
<code>false</code> to enable or disable settings that improve
performance on hosts that support Forced Unit Access (FUA)
capability.</p>
<p>Only set this variable to <code>true</code> if your hosts are
configured for FUA capability.</p>
<p>When set to <code>true</code>, the role applies the following
settings:</p>
<ul>
<li>Set the <code>traceflag 3979 on</code> setting to enable trace flag
3979 as a startup parameter</li>
<li>Set the <code>control.alternatewritethrough</code> setting to
<code>0</code></li>
<li>Set the <code>control.writethrough</code> setting to
<code>1</code></li>
</ul>
<p>When set to <code>false</code>, the role applies the following
settings:</p>
<ul>
<li>Set the <code>traceflag 3982 off</code> parameter to disable trace
flag 3979 as a startup parameter</li>
<li>Set the <code>control.alternatewritethrough</code> setting to its
default value <code>0</code></li>
<li>Set the <code>control.writethrough</code> setting to its default
value <code>0</code></li>
</ul>
<p>For more details, see SQL Server and Forced Unit Access (FUA) I/O
subsystem capability at <a
href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-performance-best-practices?view=sql-server-ver15">Performance
best practices and configuration guidelines for SQL Server on
Linux</a>.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>bool</code></p>
<h2 id="general-settings-example-playbooks">General Settings Example
Playbooks</h2>
<h3 id="configuring-basic-sql-server">Configuring Basic SQL Server</h3>
<p>This example playbook shows how to use the role to configure SQL
Server with the minimum required variables.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h1 id="managing-sql-server-version">Managing SQL Server version</h1>
<p>Use these variables to manage SQL Server version.</p>
<h2 id="managing-version-considerations">Managing Version
Considerations</h2>
<ul>
<li>The role does not support downgrading SQL Server.</li>
<li>SQL Server does not support a direct upgrade from 2017 to 2022. To
upgrade from 2017 to 2022, you must perform the upgrade in two steps -
upgrade 2017 to 2019 and then 2019 to 2022.</li>
<li>SQL Server 2022 does not support EL 7 hosts.</li>
<li>The role currently supports installing and configuring SQL Server
versions 2017, 2019, and 2022.</li>
</ul>
<h2 id="managing-version-variables">Managing Version Variables</h2>
<h3 id="mssql_version">mssql_version</h3>
<p>The version of the SQL Server to configure.</p>
<p>The role currently supports installing and configuring SQL Server
versions 2017, 2019, and 2022.</p>
<p>If unset, the role sets the variable to the currently installed SQL
Server version.</p>
<p>Note that RHEL 7 does not support SQL Server 2022.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>int</code></p>
<h3 id="mssql_upgrade">mssql_upgrade</h3>
<p>Optional: If you want to upgrade your SQL Server, set this variable
to <code>true</code> and the <code>mssql_version</code> variable to the
version to which you wish to upgrade.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h1
id="configuring-sql-server-as-a-confined-application-el-9">Configuring
SQL Server as a Confined Application (EL 9)</h1>
<p>Optional: SQL Server on RHEL 9 supports running as a confined
application with SELinux enabled. For more information, see <a
href="https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-red-hat?view=sql-server-ver16&amp;tabs=rhel9">Install
SQL Server on RHEL 9</a>.</p>
<p>You can use the role to configure SELinux with the
<code>enforcing</code> mode and install the
<code>mssql-server-selinux</code> package.</p>
<p><strong>WARNING</strong>: SQL Server supports this functionality only
on RHEL 9 running SQL Server version 2022.</p>
<h2
id="configuring-sql-server-as-a-confined-application-variables">Configuring
SQL Server as a Confined Application Variables</h2>
<h3 id="mssql_run_selinux_confined">mssql_run_selinux_confined</h3>
<p>Whether to run SQL Server as a confined application or not.</p>
<ul>
<li>If set to <code>true</code>, the role installs the
<code>mssql-server-selinux</code> package.</li>
<li>If set to <code>false</code>, the role removes the
<code>mssql-server-selinux</code> package.</li>
</ul>
<p>Default: <code>true</code> for RHEL 9 managed nodes
<code>false</code> for not RHEL 9 managed nodes</p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_manage_selinux">mssql_manage_selinux</h3>
<p>Only applicable on RHEL 9 when running as a SELinux-confined
application.</p>
<p>Whether to manage SELinux.</p>
<p>When set to <code>true</code>, configures the following SELinux
contexts and settings:</p>
<ol type="1">
<li>Ensures the <code>mssql_port_t</code> SELinux port type for <a
href="#mssql_tcp_port">mssql_tcp_port</a>.</li>
<li>When you define <a href="#mssql_datadir">mssql_datadir</a> or <a
href="#mssql_logdir">mssql_logdir</a>, configures SELinux context
<code>mssql_db_t</code> for <a href="#mssql_datadir">mssql_datadir</a>
and <code>mssql_var_t</code> for <a
href="#mssql_logdir">mssql_logdir</a>.</li>
<li>When you set <a href="#mssql_ha_configure">mssql_ha_configure</a> to
<code>true</code>, ensures the <code>mssql_port_t</code> SELinux port
type <a href="#mssql_ha_endpoint_port">mssql_ha_endpoint_port</a>.</li>
</ol>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h2
id="configuring-sql-server-as-a-confined-application-example-playbook">Configuring
SQL Server as a Confined Application Example Playbook</h2>
<p>Run the following playbook against a RHEL 9 system role to configure
SQL Server as a confined application.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2022</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_run_selinux_confined</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_selinux</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<h1 id="inputting-sql-scripts-to-sql-server">Inputting SQL Scripts to
SQL Server</h1>
<p>Optional: You can use the role to input T-SQL statements or
procedures into SQL Server.</p>
<p>You can either input a file containing T-SQL code or the code
directly. You can use on of the following methods:</p>
<ol type="1">
<li>With <a
href="#mssql_pre_input_sql_file-and-mssql_post_input_sql_file">mssql_pre_input_sql_file
and mssql_post_input_sql_file</a>, you can input a file containing T-SQL
code.</li>
<li>With <a
href="#mssql_pre_input_sql_content-and-mssql_post_input_sql_content">mssql_pre_input_sql_content
and mssql_post_input_sql_content</a>, you can input T-SQL code
directly.</li>
</ol>
<p>When specifying any of these variables, you must also specify the
<code>mssql_password</code> variable because authentication is required
to input an SQL file to SQL Server.</p>
<p>Note that the input task is not idempotent, the role always inputs an
SQL file if any of these variables is defined.</p>
<p>You can find an example of an SQL script at the role's
<code>tests/files</code> directory.</p>
<h2 id="inputting-sql-scripts-variables">Inputting SQL Scripts
Variables</h2>
<h3 id="mssql_input_sql_file">mssql_input_sql_file</h3>
<p>This variable is deprecated. Use the below variables instead.</p>
<h3
id="mssql_pre_input_sql_file-and-mssql_post_input_sql_file">mssql_pre_input_sql_file
and mssql_post_input_sql_file</h3>
<p>With these variables, enter the path to the files containing SQL
scripts.</p>
<ul>
<li>Use <code>mssql_pre_input_sql_file</code> to input the SQL file
immediately after the role configures SQL Server.</li>
<li>Use <code>mssql_post_input_sql_file</code> to input the SQL file at
the end of the role invocation.</li>
</ul>
<p>You can set these variables to a list of files, or to a string
containing a single file.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code> or <code>list</code></p>
<h3
id="mssql_pre_input_sql_content-and-mssql_post_input_sql_content">mssql_pre_input_sql_content
and mssql_post_input_sql_content</h3>
<p>With these variables, enter SQL scripts directly.</p>
<ul>
<li>Use <code>mssql_pre_input_sql_content</code> to input SQL scripts
immediately after the role configures SQL Server.</li>
<li>Use <code>mssql_post_input_sql_content</code> to input SQL scripts
at the end of the role invocation.</li>
</ul>
<p>You can set these variables to a list of scripts, or to a string
containing a single script.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code> or <code>list</code></p>
<h3 id="mssql_debug">mssql_debug</h3>
<p>Whether to print the output of sqlcmd commands when inputting T-SQL
statements and procedures.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h2 id="inputting-sql-scripts-example-playbooks">Inputting SQL Scripts
Example Playbooks</h2>
<h3 id="inputting-sql-script-files-and-content-to-sql-server">Inputting
SQL script files and content to SQL Server</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_pre_input_sql_file</span><span class="kw">:</span><span class="at"> script0.sql</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_post_input_sql_file</span><span class="kw">:</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> script1.sql</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> script2.sql</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">    mssql_pre_input_sql_file</span><span class="kw">: </span><span class="ch">|-</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      USE master;</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      IF NOT EXISTS (</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        SELECT name FROM sys.server_principals</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        WHERE name = &#39;&lt;mydomain&gt;\&lt;myADlogin&gt;&#39;</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login does not exist, creating&#39;;</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        CREATE LOGIN [&lt;mydomain&gt;\&lt;myADlogin&gt;] FROM WINDOWS;</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;The &lt;mydomain&gt;\&lt;myADlogin&gt; login created successfully&#39;;</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      END</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      ELSE</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login already exists, skipping&#39;</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>      END</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_post_input_sql_file</span><span class="kw">:</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> CREATE DATABASE ExampleDB1</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">      - </span><span class="ch">|-</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        IF NOT EXISTS(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>          SELECT name</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>          FROM sys.databases</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>          WHERE name = &#39;ExampleDB2&#39;</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        BEGIN</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>          PRINT &#39;Creating the ExampleDB2 database&#39;;</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>          CREATE DATABASE ExampleDB2;</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>          PRINT &#39;The ExampleDB2 database created successfully&#39;;</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        END</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        ELSE</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        BEGIN</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>          PRINT &#39;The ExampleDB2 database already exists, skipping&#39;;</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        END</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        GO</span></code></pre></div>
<h1 id="installing-additional-packages">Installing Additional
Packages</h1>
<p>Optional: Use these variables to install additional packages to SQL
Server host.</p>
<h2 id="additional-packages-variables">Additional Packages
Variables</h2>
<h3 id="mssql_install_fts">mssql_install_fts</h3>
<p>Set this variable to <code>true</code> or <code>false</code> to
install or remove the <code>mssql-server-fts</code> package that
provides full-text search.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_install_powershell">mssql_install_powershell</h3>
<p>Set this variable to <code>true</code> or <code>false</code> to
install or remove the <code>powershell</code> package that provides
PowerShell.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>bool</code></p>
<h1 id="configuring-custom-urls-for-packages">Configuring Custom URLs
for Packages</h1>
<p>Optional: Use these variables to configure your host to get packages
from custom URLs. This is useful if you store packages in a proxy
server.</p>
<p>When you do not provide these variables, the role uses default values
from the <code>vars/</code> directory based on operating system.</p>
<h2 id="custom-urls-variables">Custom URLs Variables</h2>
<h3 id="mssql_rpm_key">mssql_rpm_key</h3>
<p>The URL or path to the Microsoft rpm gpg keys.</p>
<p>Default:
<code>https://packages.microsoft.com/keys/microsoft.asc</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_server_repository">mssql_server_repository</h3>
<p>The URL to the Microsoft SQL Server repository.</p>
<p>Default: <code>{{ __mssql_server_repository }}</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_client_repository">mssql_client_repository</h3>
<p>The URL to the Microsoft production repository.</p>
<p>Default: <code>{{ __mssql_client_repository }}</code></p>
<p>Type: <code>string</code></p>
<h1 id="configuring-custom-data-and-logs-storage-paths">Configuring
Custom Data and Logs Storage Paths</h1>
<p>Optional: Use these variables to configure SQL Server to store data
and logs in custom paths.</p>
<h2 id="custom-paths-variables">Custom Paths Variables</h2>
<p>Use these variables to configure custom storage paths.</p>
<p>On RHEL 9, you can set <a
href="#mssql_manage_selinux">mssql_manage_selinux</a> to
<code>true</code> to set a correct SELinux context for custom
directories.</p>
<h3 id="mssql_datadir">mssql_datadir</h3>
<p>The path to the directory that SQL Server must use to store data.
When defined, the role creates the provided directory and ensures
correct permissions and ownership for it.</p>
<p>Note that if you change this path, the previously used directory and
all it's content remains at the original path.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_datadir_mode">mssql_datadir_mode</h3>
<p>The permissions to be set for the <code>mssql_datadir</code> path in
the format of the Ansible <code>file</code> module <code>mode</code>
variable.</p>
<p>Quote the mode like <code>'755'</code> so Ansible parses it as a
string to avoid conflicts with octal numbers.</p>
<p>Default: <code>'755'</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_logdir">mssql_logdir</h3>
<p>The path to the directory that SQL Server must use to store logs.
When defined, the role creates the provided directory and ensures
correct permissions and ownership for it.</p>
<p>Note that if you change this path, the previously used directory and
all it's content remains at the original path.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_logdir_mode">mssql_logdir_mode</h3>
<p>The permissions to be set for the <code>mssql_logdir</code> path in
the format of the Ansible <code>file</code> module <code>mode</code>
variable.</p>
<p>Quote the mode like <code>'755'</code> so Ansible parses it as a
string to avoid conflicts with octal numbers.</p>
<p>Default: <code>'755'</code></p>
<p>Type: <code>string</code></p>
<h1 id="configuring-network-parameters">Configuring Network
Parameters</h1>
<p>Use these variables to configure TCP port settings.</p>
<h2 id="network-parameters-variables">Network Parameters Variables</h2>
<h3 id="mssql_ip_address">mssql_ip_address</h3>
<p>The IP address that SQL Server listens on.</p>
<p>If you define this variable, the role configures SQL Server with the
defined IP address.</p>
<p>If you do not define this variable when installing SQL Server, the
role configures SQL Server to listen on the SQL Server default IP
address <code>0.0.0.0</code>, that is, to listen on every available
network interface.</p>
<p>If you do not define this variable when configuring running SQL
Server, the role does not change the IP address setting on SQL
Server.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_tcp_port">mssql_tcp_port</h3>
<p>The port that SQL Server listens on.</p>
<p>If you set <code>mssql_manage_firewall</code> to <code>false</code>,
you must open the firewall port defined with the
<code>mssql_tcp_port</code> variable prior to running this role.</p>
<p>You can change the TCP port by setting this variable to a different
port. If you set <code>mssql_manage_firewall</code> to <code>true</code>
while changing the TCP port, the role closes the previously opened
firewall port.</p>
<p>Default: <code>1433</code></p>
<p>Type: <code>int</code></p>
<h3 id="mssql_manage_firewall">mssql_manage_firewall</h3>
<p>Whether to open firewall ports required by this role.</p>
<p>When this variable is set to <code>true</code>, the role enables
firewall even if it was not enabled.</p>
<p>The role uses the <code>fedora.linux_system_roles.firewall</code>
role to manage the firewall, hence, only firewall implementations
supported by the <code>fedora.linux_system_roles.firewall</code> role
work.</p>
<p>If you set this variable to <code>false</code>, you must open
required ports prior to running this role.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h2 id="network-parameters-example-playbooks">Network Parameters Example
Playbooks</h2>
<h3
id="configuring-sql-server-with-custom-network-parameters">Configuring
SQL Server with Custom Network Parameters</h3>
<p>This example shows how to use the role to configure SQL Server,
configure it with a custom IP address and TCP port, and open the TCP
port in firewall.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tcp_port</span><span class="kw">:</span><span class="at"> </span><span class="dv">1433</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ip_address</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.0.0.0</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h1 id="configuring-tls-certificates">Configuring TLS Certificates</h1>
<p>Use the variables starting with the <code>mssql_tls_</code> prefix to
configure SQL Server to encrypt connections using TLS certificates.</p>
<p>You can either use existing TLS certificate and private key files by
providing them with <a
href="#mssql_tls_cert-and-mssql_tls_private_key">mssql_tls_cert<code>and</code>mssql_tls_private_key</a>,
or use the role to create certificates by providing <a
href="#mssql_tls_certificates">mssql_tls_certificates</a>.</p>
<h2 id="tls-certificates-variables">TLS Certificates Variables</h2>
<h3 id="mssql_tls_enable">mssql_tls_enable</h3>
<p>Set to <code>true</code> or <code>false</code> to enable or disable
TLS encryption.</p>
<p>When set to <code>true</code>, the role performs the following
tasks:</p>
<ol type="1">
<li>Copies or generates TLS certificate and private key files in
<code>/etc/pki/tls/certs/</code> and <code>/etc/pki/tls/private/</code>
directories respectively</li>
<li>Configures SQL Server to encrypt connections using TLS certificate
and private key</li>
</ol>
<p>When set to <code>false</code>, the role configures SQL Server to not
use TLS encryption. The role does not remove the existing certificate
and private key files if this variable is set to <code>false</code>.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_tls_certificates">mssql_tls_certificates</h3>
<p>Use this variable to generate certificate and private key for TLS
encryption using the
<code>fedora.linux_system_roles.certificate</code>.</p>
<p>The value of <code>mssql_tls_certificates</code> is set to the
variable <code>certificate_requests</code> in the
<code>certificate</code> role. For more information, see the
<code>certificate_requests</code> section in the
<code>certificate</code> role documentation.</p>
<p>The following example generates a certificate FILENAME.crt in
<code>/etc/pki/tls/certs</code> and a key FILENAME.key in
<code>/etc/pki/tls/private</code>.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mssql_tls_certificates</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> FILENAME</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dns</span><span class="kw">:</span><span class="at"> </span><span class="ot">*.example.com</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ca</span><span class="kw">:</span><span class="at"> self-sign</span></span></code></pre></div>
<p>When you set this variable, you must not set
<code>mssql_tls_cert</code> and <code>mssql_tls_private_key</code>
variables.</p>
<p>Default: <code>[]</code></p>
<p>Type: <code>list of dictionaries</code></p>
<h3 id="mssql_tls_cert-and-mssql_tls_private_key">mssql_tls_cert and
mssql_tls_private_key</h3>
<p>Paths to the certificate and private key files to copy to SQL
Server.</p>
<p>You are responsible for creating and securing TLS certificate and
private key files. It is assumed you have a CA that can issue these
files.</p>
<p>When you use these variables, the role copies TLS cert and private
key files to SQL Server and configures SQL Server to use these files to
encrypt connections.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_tls_remote_src">mssql_tls_remote_src</h3>
<p>Only applicable when using <a
href="#mssql_tls_cert-and-mssql_tls_private_key">mssql_tls_cert<code>and</code>mssql_tls_private_key</a>.</p>
<p>Influence whether files provided with <code>mssql_tls_cert</code> and
<code>mssql_tls_private_key</code> need to be transferred or already are
present remotely.</p>
<p>If <code>false</code>, the role searches for
<code>mssql_tls_cert</code> and <code>mssql_tls_private_key</code> files
on the controller node.</p>
<p>If <code>true</code>, the role searches for
<code>mssql_tls_cert</code> and <code>mssql_tls_private_key</code> on
managed nodes.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_tls_version">mssql_tls_version</h3>
<p>TLS version to use.</p>
<p>Default: <code>1.2</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_tls_force">mssql_tls_force</h3>
<p>Set to <code>true</code> to replace the existing certificate and
private key files on host if they exist at
<code>/etc/pki/tls/certs/</code> and <code>/etc/pki/tls/private/</code>
respectively.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h2 id="tls-certificates-example-playbooks">TLS Certificates Example
Playbooks</h2>
<h3
id="configuring-sql-server-with-tls-encryption-with-certificate-files">Configuring
SQL Server with TLS Encryption with Certificate Files</h3>
<p>This example shows how to use the role to configure SQL Server and
configure it to use TLS encryption. Certificate files
<code>mycert.pem</code> and <code>mykey.key</code> must exist on the
primary node.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_enable</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_cert</span><span class="kw">:</span><span class="at"> mycert.pem</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_private_key</span><span class="kw">:</span><span class="at"> mykey.key</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_version</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.2</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_force</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h3
id="configuring-sql-server-with-tls-encryption-with-the-certificate-role">Configuring
SQL Server with TLS Encryption with the Certificate Role</h3>
<p>This example shows how to use the role to configure SQL Server and
configure it with TLS encryption using self-signed certificate and key
created by the certificate role.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_enable</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_tls_certificates</span><span class="kw">:</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cert_name</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dns</span><span class="kw">:</span><span class="at"> </span><span class="ot">*.example.com</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ca</span><span class="kw">:</span><span class="at"> self-sign</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h1 id="configuring-always-on-availability-group">Configuring Always On
Availability Group</h1>
<p>Use the variables starting with the <code>mssql_ha_</code> prefix to
configure an SQL Server Always On availability group to provide high
availability.</p>
<p>Configuring for high availability is not supported on RHEL 7 because
the <code>fedora.linux_system_roles.ha_cluster</code> role does not
support RHEL 7.</p>
<h2 id="always-on-availability-group-prerequisites">Always On
Availability Group Prerequisites</h2>
<ul>
<li><p>Ensure that your hosts meet the requirements for high
availability configuration, namely DNS resolution configured so that
hosts can communicate using short names. For more information, see
Prerequisites in <a
href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-availability-group-configure-ha?view=sql-server-ver15#prerequisites">Configure
SQL Server Always On Availability Group for high availability on
Linux</a>.</p></li>
<li><p>Optional: In SQL Server, create one or more databases to be used
for replication. Provide databases names to the role with the <a
href="#mssql_ha_db_names">mssql_ha_db_names</a> variable. You can set
the <a
href="#mssql_pre_input_sql_file-and-mssql_post_input_sql_file">mssql_pre_input_sql_file</a>
variable to pre-create databases. For more information, see the
description of the <a href="#mssql_ha_db_names">mssql_ha_db_names</a>
variable.</p>
<p>If you do not provide the <a
href="#mssql_ha_db_names">mssql_ha_db_names</a> variable, the role
creates a cluster without replicating database in it.</p></li>
</ul>
<h2 id="configuring-the-ansible-inventory">Configuring the Ansible
Inventory</h2>
<p>You must set the <code>mssql_ha_replica_type</code> variable for each
host that you want to configure.</p>
<p>If you set <a
href="#mssql_manage_ha_cluster">mssql_manage_ha_cluster</a> to
<code>true</code>, you can provide variables required by the
<code>fedora.linux_system_roles.ha_cluster</code> role. If you do not
provide names or addresses, the
<code>fedora.linux_system_roles.ha_cluster</code> uses play's targets,
and the high availability setup requires pacemaker to be configured with
short names. Therefore, if you define hosts in inventory not by short
names, or the default hosts' IP address differs from the IP address that
pacemaker must use, you must set the corresponding
<code>fedora.linux_system_roles.ha_cluster</code> role variables.</p>
<p>For an example inventory, see <a
href="#example-inventory-for-ha-configuration">Example Inventory for HA
Configuration</a>.</p>
<p>See the <code>fedora.linux_system_roles.ha_cluster</code> role's
documentation for more information.</p>
<h2 id="always-on-availability-group-variables">Always On Availability
Group Variables</h2>
<h3 id="mssql_ha_configure">mssql_ha_configure</h3>
<p>Set to <code>true</code> to configure for high availability. Setting
to <code>false</code> does not remove configuration for high
availability.</p>
<p>When set to <code>true</code>, the role performs the following
tasks:</p>
<ol type="1">
<li>Include the <code>fedora.linux_system_roles.firewall</code> role to
configure firewall.
<ol type="1">
<li>Open the firewall port set with the <a
href="#mssql_ha_endpoint_port">mssql_ha_endpoint_port</a> variable.</li>
<li>Enable the <code>high-availability</code> service in firewall.</li>
</ol></li>
<li>Configure SQL Server for high availability.
<ol type="1">
<li>Enable AlwaysOn Health events.</li>
<li>Create certificate on the primary replica and distribute to other
replicas.</li>
<li>Configure endpoint.</li>
<li>Configure availability group with the type based on the value of the
<a href="#mssql_ha_ag_cluster_type">mssql_ha_ag_cluster_type</a>
variable.</li>
<li>Join nodes to the configured availability group.</li>
</ol></li>
<li>When <code>mssql_ha_prep_for_pacemaker = true</code>: Configure
nodes for Pacemaker.
<ol type="1">
<li>Install the <code>mssql-server-ha</code> package.</li>
<li>Configure the user provided with the <a
href="#mssql_ha_login">mssql_ha_login</a> variable for Pacemaker.</li>
<li>Configure virtual IP.</li>
</ol></li>
<li>When <a
href="#mssql_manage_ha_cluster"><code>mssql_manage_ha_cluster</code></a><code>=true</code>:
Include the <code>fedora.linux_system_roles.ha_cluster</code> role to
configure Pacemaker. You must set <a
href="#mssql_manage_ha_cluster">mssql_manage_ha_cluster</a> to
<code>true</code> and provide all variables required by the
<code>fedora.linux_system_roles.ha_cluster</code> role for a proper
Pacemaker cluster configuration based on example playbooks in <a
href="#always-on-availability-group-example-playbooks">Always On
Availability Group Example Playbooks</a>.</li>
</ol>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_ha_ag_cluster_type">mssql_ha_ag_cluster_type</h3>
<p>With this variable, provide a cluster type that you want to
configure.</p>
<p>You can set this variable to either <code>external</code> or
<code>none</code>:</p>
<ul>
<li>When set to <code>external</code>, role configures Always On
availability group for high availability with Pacemaker as described in
<a href="https://learn.microsoft.com/en-us/sql/linux/">Configure SQL
Server Always On Availability Group for high availability on
Linux</a></li>
<li>When set to <code>none</code>, role configures Always On
availability group for read-scale without Pacemaker as described in <a
href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-availability-group-configure-rs?view=sql-server-ver15">Configure
a SQL Server Availability Group for read-scale on Linux</a></li>
</ul>
<p>Default: <code>external</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_replica_type">mssql_ha_replica_type</h3>
<p>A host variable that specifies the type of the replica to be
configured on this host.</p>
<p>See <a href="#example-inventory-for-ha-configuration">Example
Inventory for HA Configuration</a> for an example inventory.</p>
<p>The available values are: <code>primary</code>,
<code>synchronous</code>, <code>asynchronous</code>,
<code>witness</code>.</p>
<p>You must set this variable to <code>primary</code> for exactly one
host.</p>
<p>You can set this variable to <code>witness</code> for maximum one
host.</p>
<p>Default: no default</p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_endpoint_port">mssql_ha_endpoint_port</h3>
<p>The TCP port used to replicate data for an Always On availability
group.</p>
<p>Note that due to an SQL Server limitation it is not possible to
change an endpoint port number on an existing availability group when
the availability group contains a configuration-only replica. To do
that, you must re-create the availability group using the required port
number.</p>
<p>If you set <code>mssql_manage_firewall</code> to <code>false</code>,
you must open the firewall port defined with the
<code>mssql_ha_endpoint_port</code> variable prior to running this
role.</p>
<p>Default: <code>5022</code></p>
<p>Type: <code>int</code></p>
<h3 id="mssql_ha_cert_name">mssql_ha_cert_name</h3>
<p>The name of the certificate used to secure transactions between
members of an Always On availability group.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_master_key_password">mssql_ha_master_key_password</h3>
<p>The password to set for the master key used with the certificate.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3
id="mssql_ha_private_key_password">mssql_ha_private_key_password</h3>
<p>The password to set for the private key used with the
certificate.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_reset_cert">mssql_ha_reset_cert</h3>
<p>Whether to reset certificates used by an Always On availability group
or not.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_ha_endpoint_name">mssql_ha_endpoint_name</h3>
<p>The name of the endpoint to be configured.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_ag_name">mssql_ha_ag_name</h3>
<p>The name of the availability group to be configured.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_db_names">mssql_ha_db_names</h3>
<p>This is an optional variable.</p>
<p>You can set this variable to the list of names of one or more
existing SQL databases to replicate these database in the cluster. The
role backs up databases provided if no back up newer than 3 hours exists
to the <code>/var/opt/mssql/data/</code> directory.</p>
<p>If you do not provide this variable when configuring new SQL Server,
the role creates a cluster without replicating databases in it.</p>
<p>The role does not remove databases not listed with this variable from
existing SQL Server clusters.</p>
<p>You can write a T-SQL script that creates database and feed it into
the role with the <a
href="#mssql_pre_input_sql_file-and-mssql_post_input_sql_file">mssql_pre_input_sql_file</a>
variable. This way, the role runs your script to create databases after
ensuring that SQL Server is running and then replicate these databases
for high availability.</p>
<p>For example, you can write a <code>create_example_db.sql</code> SQL
script that creates a test database and feed it into the SQL Server from
the primary replica with <code>mssql_pre_input_sql_file</code> prior to
running the role.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set facts to create a test DB on primary as a pre task</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">set_fact</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_pre_input_sql_file</span><span class="kw">:</span><span class="at"> create_example_db.sql</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">when</span><span class="kw">:</span><span class="at"> mssql_ha_replica_type == &#39;primary&#39;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run on all hosts to configure HA cluster</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">include_role</span><span class="kw">:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<p>Default: <code>[]</code></p>
<p>Type: <code>list</code></p>
<h2 id="configuring-pacemaker-variables">Configuring Pacemaker
Variables</h2>
<p>With these variables, you can specify whether to configure Pacemaker
HA solution and its configuration.</p>
<p>Only applicable when you set <code>mssql_ha_ag_cluster_type</code> to
<code>external</code>.</p>
<h3 id="mssql_ha_prep_for_pacemaker">mssql_ha_prep_for_pacemaker</h3>
<p>Whether to configure SQL Server for Pacemaker.</p>
<p>If set to <code>true</code>, the role does the following
configuration:</p>
<ol type="1">
<li>Configures Virtual IP in SQL Server</li>
<li>Creates a user for Pacemaker in SQL Server</li>
<li>Stores credentials for the Pacemaker user in
<code>/var/opt/mssql/secrets/passwd</code></li>
<li>Runs the <code>fedora.linux_system_roles.ha_cluster</code> role to
configure Pacemaker</li>
</ol>
<p>Default: <code>true</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_ha_virtual_ip">mssql_ha_virtual_ip</h3>
<p>The virtual IP address to be configured for the SQL cluster.</p>
<p>The role creates an availability group listener using the following
values:</p>
<ul>
<li>The port provided with the <code>mssql_tcp_port</code>
variable,</li>
<li>The IP address provided with the <code>mssql_ha_virtual_ip</code>
variable</li>
<li>The <code>255.255.255.0</code> subnet mask</li>
</ul>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_login">mssql_ha_login</h3>
<p>The user created for Pacemaker in SQL Server. This user is used by
the SQL Server Pacemaker resource agent to connect to SQL Server to
perform regular database health checks and manage state transitions from
replica to primary when needed.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ha_login_password">mssql_ha_login_password</h3>
<p>The password for the mssql_ha_login user in SQL Server.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_manage_ha_cluster">mssql_manage_ha_cluster</h3>
<p>Whether to run the <code>fedora.linux_system_roles.ha_cluster</code>
role from this role.</p>
<p>Note that the <code>fedora.linux_system_roles.ha_cluster</code> role
has the following limitation:</p>
<ul>
<li>This role replaces the configuration of HA Cluster on specified
nodes. Any settings not specified in the role variables will be
lost.</li>
<li>This role is not idempotent - it always returns changed state.</li>
</ul>
<p>To work around this limitation, the <code>microsoft.sql.server</code>
role does not set any variables for the
<code>fedora.linux_system_roles.ha_cluster</code> role to ensure that
any existing Pacemaker configuration is not re-written.</p>
<p>If you want the <code>microsoft.sql.server</code> to run the
<code>fedora.linux_system_roles.ha_cluster</code> role, set
<code>mssql_manage_ha_cluster: true</code> and provide variables for the
<code>fedora.linux_system_roles.ha_cluster</code> role with the
<code>microsoft.sql.server</code> role invocation based on example
playbooks in <a
href="#always-on-availability-group-example-playbooks">Always On
Availability Group Example Playbooks</a>.</p>
<p>If you do not want the <code>microsoft.sql.server</code> to run the
<code>fedora.linux_system_roles.ha_cluster</code> role and instead want
to run the <code>fedora.linux_system_roles.ha_cluster</code> role
independently of the <code>microsoft.sql.server</code> role, set
<code>mssql_manage_ha_cluster: false</code>.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h2 id="always-on-availability-group-example-playbooks">Always On
Availability Group Example Playbooks</h2>
<p>Examples in this section show how to use the role to configure SQL
Server and configure it for high availability in different
environments.</p>
<h3 id="example-inventory-for-ha-configuration">Example Inventory for HA
Configuration</h3>
<p>The following example inventory describes different cases:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hosts</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    # host1 is defined by a short name</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    # There is no need to specify ha_cluster names explicitly</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">host1</span><span class="kw">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> primary</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    # host2 and host3 is defined by FQDN</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    # You must define ha_cluster names to be in the short name format</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">host2.example.com</span><span class="kw">:</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> synchronous</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ha_cluster</span><span class="kw">:</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">node_name</span><span class="kw">:</span><span class="at"> host2</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">pcs_address</span><span class="kw">:</span><span class="at"> host2</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">host3.example.com</span><span class="kw">:</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> asynchronous</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ha_cluster</span><span class="kw">:</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">node_name</span><span class="kw">:</span><span class="at"> host3</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">pcs_address</span><span class="kw">:</span><span class="at"> host3</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    # host4 is defined by an ip address</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">    # You must define ha_cluster names to be in the short name format</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">    # In the case where the default host&#39;s IP address differs from the IP</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">    # address that Pacemaker must use to configure up cluster, you must define</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">    # ha_cluster corosync_addresses</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">192.XXX.XXX.333</span><span class="kw">:</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> witness</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ha_cluster</span><span class="kw">:</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">node_name</span><span class="kw">:</span><span class="at"> host4</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">pcs_address</span><span class="kw">:</span><span class="at"> host4</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">corosync_addresses</span><span class="kw">:</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> 10.XXX.XXX.333</span></span></code></pre></div>
<h3
id="configuring-sql-server-with-a-none-cluster-type-for-read-scale-without-pacemaker">Configuring
SQL Server with a <code>none</code> Cluster Type for Read-scale without
Pacemaker</h3>
<p>Use the following example to configure SQL Server Always On for
read-scale. In this case, the role does not configure Pacemaker.</p>
<p>Inventory:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hosts</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">client-mssql-1</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ansible_host</span><span class="kw">:</span><span class="at"> &lt;IP or FQDN&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> primary</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">client-mssql-2</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ansible_host</span><span class="kw">:</span><span class="at"> &lt;IP or FQDN&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> asynchronous</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">client-mssql-3</span><span class="kw">:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ansible_host</span><span class="kw">:</span><span class="at"> &lt;IP or FQDN&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mssql_ha_replica_type</span><span class="kw">:</span><span class="at"> asynchronous</span></span></code></pre></div>
<p>Playbook:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2022</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_cluster_type</span><span class="kw">:</span><span class="at"> none</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5022</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_cert_name</span><span class="kw">:</span><span class="at"> ExampleCert</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_master_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD1&quot;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_private_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD2&quot;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_reset_cert</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_name</span><span class="kw">:</span><span class="at"> Example_Endpoint</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_name</span><span class="kw">:</span><span class="at"> ExampleAG</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_db_names</span><span class="kw">:</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB1</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB2</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h3
id="configuring-sql-server-with-ha-and-pacemaker-on-bare-metal">Configuring
SQL Server with HA and Pacemaker on Bare Metal</h3>
<p>If you want to configure Pacemaker from this role, you can set <a
href="#mssql_manage_ha_cluster">mssql_manage_ha_cluster</a> to
<code>true</code> and provide variables required by the
<code>fedora.linux_system_roles.ha_cluster</code> role to configure
Pacemaker for your environment properly.</p>
<p>This example configures required Pacemaker properties and resources
and enables SBD watchdog.</p>
<p>The <code>fedora.linux_system_roles.ha_cluster</code> role expects
watchdog devices to be configured on <code>/dev/watchdog</code> by
default, you can set a different device per host in inventory. For more
information, see the <code>fedora.linux_system_roles.ha_cluster</code>
role documentation.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_cluster_type</span><span class="kw">:</span><span class="at"> external</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5022</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_cert_name</span><span class="kw">:</span><span class="at"> ExampleCert</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_master_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD1&quot;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_private_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD2&quot;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_reset_cert</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_name</span><span class="kw">:</span><span class="at"> Example_Endpoint</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_name</span><span class="kw">:</span><span class="at"> ExampleAG</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_db_names</span><span class="kw">:</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB1</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB2</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_login</span><span class="kw">:</span><span class="at"> ExampleLogin</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_login_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD3&quot;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_virtual_ip</span><span class="kw">:</span><span class="at"> 192.XXX.XXX.XXX</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_ha_cluster</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_cluster_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_ag_name }}&quot;</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_hacluster_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD4&quot;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_sbd_enabled</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_cluster_properties</span><span class="kw">:</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster-recheck-interval</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 2min</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> start-failure-is-fatal</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stonith-enabled</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stonith-watchdog-timeout</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_primitives</span><span class="kw">:</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> ocf:mssql:ag</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ag_name</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_ag_name }}&quot;</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meta_attrs</span><span class="kw">:</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> failure-timeout</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 60s</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> ocf:heartbeat:IPaddr2</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ip</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_virtual_ip }}&quot;</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">operations</span><span class="kw">:</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">action</span><span class="kw">:</span><span class="at"> monitor</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> interval</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 30s</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_clones</span><span class="kw">:</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_id</span><span class="kw">:</span><span class="at"> ag_cluster</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">promotable</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meta_attrs</span><span class="kw">:</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> notify</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_constraints_colocation</span><span class="kw">:</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_leader</span><span class="kw">:</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster-clone</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">role</span><span class="kw">:</span><span class="at"> Promoted</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_follower</span><span class="kw">:</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">options</span><span class="kw">:</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> score</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> INFINITY</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_constraints_order</span><span class="kw">:</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_first</span><span class="kw">:</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster-clone</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">action</span><span class="kw">:</span><span class="at"> promote</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_then</span><span class="kw">:</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">action</span><span class="kw">:</span><span class="at"> start</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h3
id="configuring-sql-server-with-ha-and-pacemaker-on-vmware">Configuring
SQL Server with HA and Pacemaker on VMWare</h3>
<p>If you want to configure Pacemaker from this role, you can set <a
href="#mssql_manage_ha_cluster">mssql_manage_ha_cluster</a> to
<code>true</code> and provide variables required by the
<code>fedora.linux_system_roles.ha_cluster</code> role to configure
Pacemaker for your environment properly. See the
<code>fedora.linux_system_roles.ha_cluster</code> role documentation for
more information.</p>
<p>Note that production environments require Pacemaker configured with
fencing agents, this example playbook configures the
<code>stonith:fence_vmware_soap</code> agent.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_cluster_type</span><span class="kw">:</span><span class="at"> external</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5022</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_cert_name</span><span class="kw">:</span><span class="at"> ExampleCert</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_master_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD1&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_private_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD2&quot;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_reset_cert</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_name</span><span class="kw">:</span><span class="at"> Example_Endpoint</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_name</span><span class="kw">:</span><span class="at"> ExampleAG</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_db_names</span><span class="kw">:</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB1</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB2</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_login</span><span class="kw">:</span><span class="at"> ExampleLogin</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_login_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD3&quot;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_virtual_ip</span><span class="kw">:</span><span class="at"> 192.XXX.XXX.XXX</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_ha_cluster</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_cluster_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_ag_name }}&quot;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_hacluster_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD4&quot;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_cluster_properties</span><span class="kw">:</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster-recheck-interval</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 2min</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> start-failure-is-fatal</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stonith-enabled</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_primitives</span><span class="kw">:</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> vmfence</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> stonith:fence_vmware_soap</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> vmware_Login</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> passwd</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> vmware_password</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ip</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> vmware_ip</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ssl_insecure</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> ocf:mssql:ag</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ag_name</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_ag_name }}&quot;</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meta_attrs</span><span class="kw">:</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> failure-timeout</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 60s</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> ocf:heartbeat:IPaddr2</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ip</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_virtual_ip }}&quot;</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">operations</span><span class="kw">:</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">action</span><span class="kw">:</span><span class="at"> monitor</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> interval</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 30s</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_clones</span><span class="kw">:</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_id</span><span class="kw">:</span><span class="at"> ag_cluster</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">promotable</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meta_attrs</span><span class="kw">:</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> notify</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_constraints_colocation</span><span class="kw">:</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_leader</span><span class="kw">:</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster-clone</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">role</span><span class="kw">:</span><span class="at"> Promoted</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_follower</span><span class="kw">:</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">options</span><span class="kw">:</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> score</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> INFINITY</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_constraints_order</span><span class="kw">:</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_first</span><span class="kw">:</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster-clone</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">action</span><span class="kw">:</span><span class="at"> promote</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_then</span><span class="kw">:</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">action</span><span class="kw">:</span><span class="at"> start</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h3
id="configuring-sql-server-with-ha-and-pacemaker-on-azure">Configuring
SQL Server with HA and Pacemaker on Azure</h3>
<p>If you want to configure Pacemaker from this role, you can set <a
href="#mssql_manage_ha_cluster">mssql_manage_ha_cluster</a> to
<code>true</code> and provide variables required by the
<code>fedora.linux_system_roles.ha_cluster</code> role to configure
Pacemaker for your environment properly. See the
<code>fedora.linux_system_roles.ha_cluster</code> role documentation for
more information.</p>
<h3 id="ha-and-pacemaker-on-azure-prerequisites">HA and Pacemaker on
Azure Prerequisites</h3>
<ul>
<li><p>You must configure all required resources in Azure. For more
information, see the following articles in Microsoft documentation:</p>
<ul>
<li><a
href="https://docs.microsoft.com/en-us/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-pacemaker#1-create-the-stonith-devices">Setting
up Pacemaker on Red Hat Enterprise Linux in Azure</a></li>
<li><a
href="https://docs.microsoft.com/en-us/azure/azure-sql/virtual-machines/linux/rhel-high-availability-stonith-tutorial?view=azuresql">Tutorial:
Configure availability groups for SQL Server on RHEL virtual machines in
Azure</a></li>
</ul></li>
</ul>
<p>Note that production environments require Pacemaker configured with
fencing agents, this example playbook configures the
<code>stonith:fence_azure_arm</code> agent.</p>
<p>This example playbooks sets the <code>firewall</code> variables for
the <code>fedora.linux_system_roles.firewall</code> role and then runs
this role to open the probe port configured in Azure.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2019</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_cluster_type</span><span class="kw">:</span><span class="at"> external</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5022</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_cert_name</span><span class="kw">:</span><span class="at"> ExampleCert</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_master_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD1&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_private_key_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD2&quot;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_reset_cert</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_endpoint_name</span><span class="kw">:</span><span class="at"> Example_Endpoint</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_ag_name</span><span class="kw">:</span><span class="at"> ExampleAG</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_db_names</span><span class="kw">:</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB1</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ExampleDB2</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_login</span><span class="kw">:</span><span class="at"> ExampleLogin</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_login_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD3&quot;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">    # Set mssql_ha_virtual_ip to the frontend IP address configured in the Azure</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">    # load balancer</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ha_virtual_ip</span><span class="kw">:</span><span class="at"> 192.XXX.XXX.XXX</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_ha_cluster</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_cluster_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_ag_name }}&quot;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_hacluster_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD4&quot;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_extra_packages</span><span class="kw">:</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> fence-agents-azure-arm</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_cluster_properties</span><span class="kw">:</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster-recheck-interval</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 2min</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> start-failure-is-fatal</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stonith-enabled</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stonith-timeout</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">900</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_primitives</span><span class="kw">:</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> rsc_st_azure</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> stonith:fence_azure_arm</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> login</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> ApplicationID</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> passwd</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> servicePrincipalPassword</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> resourceGroup</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> resourceGroupName</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> tenantId</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> tenantID</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subscriptionId</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> subscriptionID</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> power_timeout</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">240</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> pcmk_reboot_timeout</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">900</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> azure_load_balancer</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> azure-lb</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="co">            # probe port configured in Azure</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> port</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">59999</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> ocf:mssql:ag</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ag_name</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_ag_name }}&quot;</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meta_attrs</span><span class="kw">:</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> failure-timeout</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 60s</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> ocf:heartbeat:IPaddr2</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">instance_attrs</span><span class="kw">:</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ip</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;{{ mssql_ha_virtual_ip }}&quot;</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">operations</span><span class="kw">:</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">action</span><span class="kw">:</span><span class="at"> monitor</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> interval</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">value</span><span class="kw">:</span><span class="at"> 30s</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_groups</span><span class="kw">:</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> virtualip_group</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_ids</span><span class="kw">:</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> azure_load_balancer</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> virtualip</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_resource_clones</span><span class="kw">:</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_id</span><span class="kw">:</span><span class="at"> ag_cluster</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">promotable</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">meta_attrs</span><span class="kw">:</span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">attrs</span><span class="kw">:</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> notify</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_constraints_colocation</span><span class="kw">:</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_leader</span><span class="kw">:</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster-clone</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">role</span><span class="kw">:</span><span class="at"> Promoted</span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_follower</span><span class="kw">:</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> azure_load_balancer</span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">options</span><span class="kw">:</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> score</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">value</span><span class="kw">:</span><span class="at"> INFINITY</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ha_cluster_constraints_order</span><span class="kw">:</span></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">resource_first</span><span class="kw">:</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> ag_cluster-clone</span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">action</span><span class="kw">:</span><span class="at"> promote</span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resource_then</span><span class="kw">:</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">id</span><span class="kw">:</span><span class="at"> azure_load_balancer</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">action</span><span class="kw">:</span><span class="at"> start</span></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a><span class="co">    # Variables to open the probe port configured in Azure in firewall</span></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">firewall</span><span class="kw">:</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">port</span><span class="kw">:</span><span class="at"> 59999/tcp</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">state</span><span class="kw">:</span><span class="at"> enabled</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">permanent</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">runtime</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">roles</span><span class="kw">:</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> fedora.linux_system_roles.firewall</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> microsoft.sql.server</span></span></code></pre></div>
<h1
id="configuring-sql-server-to-authenticate-with-active-directory-ad-server">Configuring
SQL Server to authenticate with Active Directory (AD) Server</h1>
<p>Optional: Use variables starting with the <code>mssql_ad_</code>
prefix to configure SQL Server to authenticate with Microsoft AD
Server.</p>
<h2 id="ad-considerations">AD Considerations</h2>
<p>This role uses the
<code>fedora.linux_system_roles.ad_integration</code> role to join SQL
Server with AD server.</p>
<p>To join to AD server, you must also provide the following variables
for the <code>ad_integration</code> role:</p>
<ul>
<li><p><code>ad_integration_realm</code> - to optionally join to the AD
and create a keytab file</p></li>
<li><p><code>ad_integration_user</code> - to optionally join to the AD
and obtain Kerberos ticket if <a
href="#mssql_ad_kerberos_user">mssql_ad_kerberos_user</a> is not
provided</p></li>
<li><p><code>ad_integration_password</code> - to authenticate
<code>ad_integration_user</code></p></li>
<li><p>Optional, You can configure DNS using ad_integration role by
providing the following variables:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ad_integration_manage_dns</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ad_integration_dns_server</span><span class="kw">:</span><span class="at"> &lt;AD_server_IP&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ad_integration_dns_connection_name</span><span class="kw">:</span><span class="at"> &lt;linux_network_interface&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ad_integration_dns_connection_type</span><span class="kw">:</span><span class="at"> ethernet</span></span></code></pre></div></li>
<li><p>Optional: You can provide further variables for the
<code>fedora.linux_system_roles.ad_integration</code> role if you
need.</p></li>
</ul>
<p>Optional: If you have already joined managed nodes to AD and you want
to skip running the ad_integration role, you can set the <a
href="#mssql_ad_join">mssql_ad_join</a> variable to false.</p>
<h2 id="ad-prerequisites">AD Prerequisites</h2>
<p>Ensure that your AD Server and Linux host meet the prerequisites for
joining. For more information, see <a
href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-active-directory-join-domain?view=sql-server-ver15#prerequisites">Join
SQL Server on a Linux host to an Active Directory domain</a> and <a
href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-ad-auth-troubleshooting?view=sql-server-ver15">Troubleshoot
Active Directory authentication for SQL Server on Linux and
containers</a> in Microsoft documentation.</p>
<h2 id="finishing-ad-server-configuration">Finishing AD Server
Configuration</h2>
<ol type="1">
<li><p>After you execute the role to configure AD Server authentication,
you must complete one of the following procedures to add AES128 and
AES256 kerberos encryption types to the <a
href="#mssql_ad_sql_user">mssql_ad_sql_user</a> on AD Server.</p>
<ul>
<li><p>For the RSAT UI users, complete the following steps:</p>
<ol type="1">
<li>Launch <strong>Active Directory Users and Computers</strong></li>
<li>Navigate to the SQL User (Default: <em><strong>domain</strong></em>
&gt; <strong>Users</strong> &gt; <em><strong>sqluser</strong></em>)</li>
<li>Right click the SQL User account and select
<strong>Properties</strong></li>
<li>In the <strong>Account</strong> tab, select <strong>This account
supports Kerberos AES 128 bit encryption</strong> and <strong>This
account supports Kerberos AES 256 bit encryption</strong></li>
<li>Click <strong>Apply</strong></li>
</ol></li>
<li><p>For the PowerShell users, enter the following command:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Set-ADUser</span> <span class="op">-</span>Identity <span class="op">&lt;</span>sqluser<span class="op">&gt;</span> <span class="op">-</span>KerberosEncryptionType AES128<span class="op">,</span>AES256</span></code></pre></div></li>
</ul></li>
<li><p>You must create Active Directory-based logins in Transact-SQL as
described in <a
href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-ad-auth-adutil-tutorial?view=sql-server-ver16#create-active-directory-based-sql-server-logins-in-transact-sql">Create
Active Directory-based SQL Server logins in Transact-SQL</a> in
<em>Tutorial: Use adutil to configure Active Directory authentication
with SQL Server on Linux</em> in Microsoft documentation. You can write
a T-SQL script and input it as described in <a
href="#inputting-sql-scripts-to-sql-server">mssql_post_input_sql_file</a>.
See example playbooks for how to create logins using the
<code>mssql_post_input_sql_content</code> variable.</p></li>
</ol>
<h2 id="verifying-authentication">Verifying Authentication</h2>
<p>After you execute the role to configure AD Server authentication and
complete <a href="#finishing-ad-server-configuration">Finishing AD
Server Configuration</a>, you can log in using Azure Data Studio or
complete the following procedure to verify that you can log in to SQL
Server from your Linux machine using the <code>&lt;sqluser&gt;</code>
account.</p>
<ol type="1">
<li><p>SSH into the <code>*&lt;sqluser&gt;@&lt;domain.com&gt;*</code>
user on your Linux <em>client.domain.com</em> machine:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-l</span> <span class="op">&lt;</span>sqluser<span class="op">&gt;</span>@<span class="op">&lt;</span>domain.com<span class="op">&gt;</span> <span class="op">&lt;</span>client.domain.com<span class="op">&gt;</span></span></code></pre></div></li>
<li><p>Obtain Kerberos ticket for the Administrator user:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kinit</span> Administrator@<span class="op">&lt;</span>DOMAIN.COM<span class="op">&gt;</span></span></code></pre></div></li>
<li><p>Use <code>sqlcmd</code> to log in to SQL Server and, for example,
run the query to get current user:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/opt/mssql-tools/bin/sqlcmd</span> <span class="at">-S.</span> <span class="at">-Q</span> <span class="st">&#39;SELECT SYSTEM_USER&#39;</span></span></code></pre></div></li>
</ol>
<h2 id="ad-variables">AD Variables</h2>
<h3 id="mssql_ad_configure">mssql_ad_configure</h3>
<p>Set this variable to <code>true</code> to configure for AD Server
authentication. Setting to <code>false</code> does not remove
configuration for AD Server authentication.</p>
<p>For an example playbook, see <a
href="#configuring-ad-integration-with-general-parameters">Configuring
AD integration with a pre-created keytab file</a>.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_ad_join">mssql_ad_join</h3>
<p>Optional: If you have already joined managed nodes to AD and you want
to skip running the ad_integration role, you can set this variable to
<code>false</code>.</p>
<p>For an example playbook, see <a
href="#configuring-ad-integration-without-joining-to-ad">Configuring AD
integration with a pre-created keytab file</a>.</p>
<p>If you define the <code>ad_integration_user</code> variable, the role
obtains the kerberos ticket for creating keytab for the
<code>ad_integration_user@ad_integration_realm</code> user with the
<code>ad_integration_password</code> password. If you don't define the
<code>ad_integration_user</code> variable, the role obtains the kerberos
ticket for <code>mssql_ad_sql_user@ad_integration_realm</code> user with
the <code>mssql_ad_sql_password</code> password.</p>
<p>Default: <code>true</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_ad_kerberos_user">mssql_ad_kerberos_user</h3>
<p>Optional, you can use a specific user for obtaining kerberos ticket
for creating the <code>mssql_ad_sql_user</code> user and keytab.</p>
<p>By default, the role uses the following logic:</p>
<ol type="1">
<li><p>If you define the <code>ad_integration_user</code> variable, the
role obtains the kerberos ticket for the
<code>ad_integration_user@ad_integration_realm</code> user with the
<code>ad_integration_password</code> password.</p></li>
<li><p>If you don't define the <code>ad_integration_user</code>
variable, the role obtains the kerberos ticket for
<code>mssql_ad_sql_user@ad_integration_realm</code> user with the
<code>mssql_ad_sql_password</code> password.</p></li>
</ol>
<p>Default:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mssql_ad_kerberos_user</span><span class="kw">: </span><span class="ch">&gt;-</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  {{ ad_integration_user if ad_integration_user is defined</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  else mssql_ad_sql_user }}</span></code></pre></div>
<p>Type: <code>string</code></p>
<h3 id="mssql_ad_kerberos_password">mssql_ad_kerberos_password</h3>
<p>Optional, the password to use for obtaining kerberos ticket for the
<code>mssql_ad_kerberos_user</code> user.</p>
<p>Default:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mssql_ad_kerberos_password</span><span class="kw">: </span><span class="ch">&gt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  {{ ad_integration_password if ad_integration_user is defined</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  else mssql_ad_sql_password }}</span></code></pre></div>
<p>Type: <code>string</code></p>
<h3 id="mssql_ad_keytab_file">mssql_ad_keytab_file</h3>
<p>Optional: You can use this variable if you don't want the role to
generate a keytab file and instead want to pass a pre-created keytab
file to mssql-server.</p>
<p>A keytab file must be pre-created on AD Server as per <a
href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-active-directory-authentication?view=sql-server-ver16">Tutorial:
Use Active Directory authentication with SQL Server on Linux</a>. You
must ensure that the keytab file is created for the managed node's
hostname and for the user provided with the
<code>mssql_ad_sql_user</code> variable.</p>
<p>For an example playbook, see <a
href="#configuring-ad-integration-with-a-pre-created-keytab-file">Configuring
AD integration with a pre-created keytab file</a>.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ad_keytab_remote_src">mssql_ad_keytab_remote_src</h3>
<p>Optional: Only applicable when using <a
href="#mssql_ad_keytab_file">mssql_ad_keytab_file</a>.</p>
<p>Influence whether the <code>mssql_ad_keytab_file</code> file needs to
be transferred or already is present remotely.</p>
<p>If <code>false</code>, the role searches for the
<code>mssql_ad_keytab_file</code> file on the controller node.</p>
<p>If <code>true</code>, the role searches for the
<code>mssql_ad_keytab_file</code> file on managed nodes.</p>
<p>Default: <code>false</code></p>
<p>Type: <code>bool</code></p>
<h3 id="mssql_ad_sql_user">mssql_ad_sql_user</h3>
<p>User to be created in SQL Server and used for authentication.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ad_sql_password">mssql_ad_sql_password</h3>
<p>Password to be set for the <a
href="#mssql_ad_sql_user">mssql_ad_sql_user</a> user.</p>
<p>This variable is not required when using <a
href="#mssql_ad_keytab_file">mssql_ad_keytab_file</a>.</p>
<p>Default: <code>null</code></p>
<p>Type: <code>string</code></p>
<h3 id="mssql_ad_sql_user_dn">mssql_ad_sql_user_dn</h3>
<p>Optional: You must set <code>mssql_ad_sql_user_dn</code> if your AD
server stores user account in a custom OU rather than in the
<code>Users</code> OU.</p>
<p>AD distinguished name to create the <a
href="#mssql_ad_sql_user">mssql_ad_sql_user</a> at.</p>
<p>By default, the role builds <code>mssql_ad_sql_user_dn</code> the
following way:</p>
<ol type="1">
<li><code>CN={{ mssql_ad_sql_user }},</code> - name of the user created
in AD</li>
<li><code>CN=Users,</code> - the <code>Users</code> OU where AD stores
users by default</li>
<li><code>DC=&lt;subdomain1&gt;,DC=&lt;subdomain2&gt;,DC=&lt;subdomainN&gt;,</code>
- all subdomain portions of the AD domain name provided with the
<code>ad_integration_realm</code> variable</li>
<li><code>DC=&lt;TLD&gt;</code> - top level domain</li>
</ol>
<p>For example: <code>CN=sqluser,CN=Users,DC=DOMAIN,DC=COM</code>.</p>
<p>Default:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mssql_ad_sql_user_dn</span><span class="kw">: </span><span class="ch">&gt;-</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  CN={{ mssql_ad_sql_user }},</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  CN=Users,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  {{ ad_integration_realm.split(&quot;.&quot;)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  | map(&quot;regex_replace&quot;,&quot;^&quot;,&quot;DC=&quot;)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  | join(&quot;,&quot;) }}</span></code></pre></div>
<p>Type: <code>string</code></p>
<h2 id="ad-example-playbooks">AD Example Playbooks</h2>
<h3 id="configuring-ad-integration-with-general-parameters">Configuring
AD integration with general parameters</h3>
<div class="sourceCode" id="cb23"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Configure with AD server authentication</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2022</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_sql_user</span><span class="kw">:</span><span class="at"> sqluser</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_sql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD1&quot;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_realm</span><span class="kw">:</span><span class="at"> domain.com</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_user</span><span class="kw">:</span><span class="at"> Administrator</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_password</span><span class="kw">:</span><span class="at"> Secret123</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_manage_dns</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_dns_server</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.1.1.1</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_dns_connection_name</span><span class="kw">:</span><span class="at"> eth0</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_dns_connection_type</span><span class="kw">:</span><span class="at"> ethernet</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="fu">    mssql_post_input_sql_content</span><span class="kw">: </span><span class="ch">|-</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>      USE master;</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>      IF NOT EXISTS (</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        SELECT name FROM sys.server_principals</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        WHERE name = &#39;&lt;mydomain&gt;\&lt;myADlogin&gt;&#39;</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login does not exist, creating&#39;;</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        CREATE LOGIN [&lt;mydomain&gt;\&lt;myADlogin&gt;] FROM WINDOWS;</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;The &lt;mydomain&gt;\&lt;myADlogin&gt; login created successfully&#39;;</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>      END</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>      ELSE</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login already exists, skipping&#39;</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>      END</span></code></pre></div>
<h3
id="configuring-ad-integration-with-a-pre-created-keytab-file">Configuring
AD integration with a pre-created keytab file</h3>
<p>If you received a pre-created keytab file and want the role to use
it, set variables like in this example:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Configure with AD server authentication with a pre-created keytab file</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2022</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_keytab_file</span><span class="kw">:</span><span class="at"> /path/to/file</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_keytab_remote_src</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_sql_user</span><span class="kw">:</span><span class="at"> sqluser</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_realm</span><span class="kw">:</span><span class="at"> domain.com</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_user</span><span class="kw">:</span><span class="at"> Administrator</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_manage_dns</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_dns_server</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.1.1.1</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_dns_connection_name</span><span class="kw">:</span><span class="at"> eth0</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_dns_connection_type</span><span class="kw">:</span><span class="at"> ethernet</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">    mssql_post_input_sql_content</span><span class="kw">: </span><span class="ch">|-</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>      USE master;</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>      IF NOT EXISTS (</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        SELECT name FROM sys.server_principals</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        WHERE name = &#39;&lt;mydomain&gt;\&lt;myADlogin&gt;&#39;</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login does not exist, creating&#39;;</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        CREATE LOGIN [&lt;mydomain&gt;\&lt;myADlogin&gt;] FROM WINDOWS;</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;The &lt;mydomain&gt;\&lt;myADlogin&gt; login created successfully&#39;;</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>      END</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>      ELSE</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login already exists, skipping&#39;</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>      END</span></code></pre></div>
<h3 id="configuring-ad-integration-without-joining-to-ad">Configuring AD
integration without joining to AD</h3>
<p>You must join managed host to AD Server yourself prior to running
this playbook.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Configure with AD server authentication without joining to AD</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hosts</span><span class="kw">:</span><span class="at"> all</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vars</span><span class="kw">:</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_odbc_driver_17_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_cli_utilities_for_sql_server_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_accept_microsoft_sql_server_standard_eula</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2022</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;p@55w0rD&quot;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_edition</span><span class="kw">:</span><span class="at"> Evaluation</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_manage_firewall</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_configure</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_join</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_sql_user</span><span class="kw">:</span><span class="at"> sqluser</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_kerberos_user</span><span class="kw">:</span><span class="at"> user_administrator</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">mssql_ad_kerberos_password</span><span class="kw">:</span><span class="at"> Secret123</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ad_integration_realm</span><span class="kw">:</span><span class="at"> domain.com</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="fu">    mssql_post_input_sql_content</span><span class="kw">: </span><span class="ch">|-</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>      USE master;</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      IF NOT EXISTS (</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        SELECT name FROM sys.server_principals</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        WHERE name = &#39;&lt;mydomain&gt;\&lt;myADlogin&gt;&#39;</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login does not exist, creating&#39;;</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        CREATE LOGIN [&lt;mydomain&gt;\&lt;myADlogin&gt;] FROM WINDOWS;</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;The &lt;mydomain&gt;\&lt;myADlogin&gt; login created successfully&#39;;</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>      END</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>      ELSE</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>      BEGIN</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        PRINT &#39;A &lt;mydomain&gt;\&lt;myADlogin&gt; login already exists, skipping&#39;</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>      END</span></code></pre></div>
<h1 id="license">License</h1>
<p>MIT</p>
</article>
</body>
</html>
